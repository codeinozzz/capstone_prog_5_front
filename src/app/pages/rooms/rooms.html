<app-header></app-header>

<div class="rooms-page">
  
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading hotel information...</p>
  </div>

  <div *ngIf="error && !loading" class="error-container">
    <mat-icon>error_outline</mat-icon>
    <h3>Error</h3>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to hotels
    </button>
  </div>

  <div *ngIf="hotel && !loading && !error" class="rooms-container">
    
    <div class="hotel-header">
      <button mat-button (click)="goBack()" class="back-btn">
        <mat-icon>arrow_back</mat-icon>
        Back to hotels
      </button>
      
      <div class="hotel-info">
        <h2>{{ hotel.name | titlecase }}</h2>
        <p>
          <mat-icon>location_on</mat-icon>
          {{ hotel.location | titlecase }}
        </p>
      </div>
    </div>

    <mat-card class="date-selector">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>date_range</mat-icon>
          Select your dates
        </mat-card-title>
        <mat-card-subtitle>
          Choose the dates to see available rooms
        </mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="dateForm" class="date-form">
          <mat-form-field appearance="outline">
            <mat-label>Check-in</mat-label>
            <input 
              matInput 
              [matDatepicker]="checkInPicker"
              formControlName="checkIn"
              [min]="minDate">
            <mat-datepicker-toggle matSuffix [for]="checkInPicker"></mat-datepicker-toggle>
            <mat-datepicker #checkInPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Check-out</mat-label>
            <input 
              matInput 
              [matDatepicker]="checkOutPicker"
              formControlName="checkOut"
              [min]="minDate">
            <mat-datepicker-toggle matSuffix [for]="checkOutPicker"></mat-datepicker-toggle>
            <mat-datepicker #checkOutPicker></mat-datepicker>
          </mat-form-field>
        </form>
      </mat-card-content>
    </mat-card>

    <div class="availability-status" *ngIf="dateForm.valid">
      <div *ngIf="roomsLoading" class="loading-rooms">
        <mat-spinner diameter="24"></mat-spinner>
        <span>Checking availability...</span>
      </div>
      
      <div *ngIf="!roomsLoading && rooms.length > 0" class="rooms-found">
        <mat-icon>check_circle</mat-icon>
        <span>{{ rooms.length }} room(s) available</span>
      </div>
      
      <div *ngIf="!roomsLoading && rooms.length === 0 && isValidDateRange()" class="no-rooms">
        <mat-icon>info</mat-icon>
        <span>No rooms available for these dates</span>
      </div>
    </div>

    <div *ngIf="rooms.length > 0" class="rooms-grid">
      <mat-card *ngFor="let room of rooms" class="room-card">
        <mat-card-header>
          <mat-card-title>{{ getRoomTypeLabel(room.type) }}</mat-card-title>
          <mat-card-subtitle>
            <mat-icon>people</mat-icon>
            Up to {{ room.capacity }} {{ room.capacity === 1 ? 'person' : 'people' }}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="room-info">
            <div class="room-detail">
              <mat-icon>bed</mat-icon>
              <span>{{ room.beds || 'Standard bed' }}</span>
            </div>
            
            <div class="room-detail" *ngIf="room.amenities?.length">
              <mat-icon>star</mat-icon>
              <span>{{ room.amenities.slice(0, 2).join(', ') }}</span>
            </div>
          </div>

          <div class="room-price">
            <strong>{{ room.price | currency:'USD':'symbol':'1.0-0' }}</strong>
            <small>per night</small>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="onBookRoom(room)"
            [disabled]="!isValidDateRange()"
            class="reserve-room-btn">
            <mat-icon>book_online</mat-icon>
            Book
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div *ngIf="!dateForm.valid" class="select-dates-prompt">
      <mat-icon>date_range</mat-icon>
      <h3>Select your dates</h3>
      <p>Choose check-in and check-out dates to see available rooms</p>
    </div>

  </div>
</div>

<app-footer></app-footer>
